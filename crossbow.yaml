config:
  progress: true

env:
  PORT: 9000
  LH_BIN: /Users/shakyshane/Sites/oss/perf-battle/dist/index.js
  GLIMMER_DIR: glimmer-app
  EMBER_DIR: ember-app
  CRA_DIR: cra-app
  NG_DIR: ng-app

tasks:
  (glimmer):
    clean:
      - '@sh rm -rf $GLIMMER_DIR'
    init: >
      @npm ember new $GLIMMER_DIR -b @glimmer/blueprint
    build: >
      @sh cd $GLIMMER_DIR
      && ember build --environment="production"
    serve: >
      @sh pushstate-server $GLIMMER_DIR/dist $PORT
    perf-battle: >
      @sh node $LH_BIN
      http://localhost:$PORT
      --reporter size
      --output json
      --outFile results/glimmer.json

    lighthouse:
      - glimmer:perf-battle
      - '@cb exit'

  glimmer-run:
    description: Create production Glimmer app & test in lighthouse
    tasks:
      - glimmer:build
      - [glimmer:serve, glimmer:lighthouse]


  (ember):
    clean:
      - '@sh rm -rf $EMBER_DIR'
    init: >
      @npm ember new $EMBER_DIR
    build: >
      @sh cd $EMBER_DIR
      && ember build --environment="production"
    serve: >
      @sh pushstate-server $EMBER_DIR/dist $PORT
    perf-battle: >
      @sh node $LH_BIN
      http://localhost:$PORT
      --reporter size
      --output json
      --outFile results/ember.json

    lighthouse:
      - ember:perf-battle
      - '@cb exit'

  ember-run:
    description: Create production Ember app & test in lighthouse
    tasks:
      - ember:build
      - [ember:serve, ember:lighthouse]

  (cra):
    clean:
      - '@sh rm -rf $CRA_DIR'
    init: >
      @npm create-react-app $CRA_DIR
    build: >
      @sh cd $CRA_DIR
      && yarn run build
    serve: >
      @sh pushstate-server $CRA_DIR/build $PORT
    perf-battle: >
      @sh node $LH_BIN
      http://localhost:$PORT
      --reporter size
      --output json
      --outFile results/cra.json

    lighthouse:
      - cra:perf-battle
      - '@cb exit'

  cra-run:
    description: Create production React app & test in lighthouse
    tasks:
      - cra:build
      - [cra:serve, cra:lighthouse]

  (ng):
    clean:
      - '@sh rm -rf $NG_DIR'
    init: >
      @npm ng new $NG_DIR
    build: >
      @npm cd $NG_DIR
      && ng build --aot --target=production
    serve: >
      @sh pushstate-server $NG_DIR/dist $PORT
    perf-battle: >
      @sh node $LH_BIN
      http://localhost:$PORT
      --reporter size
      --output json
      --outFile results/ng.json

    lighthouse:
      - ng:perf-battle
      - '@cb exit'

  ng-run:
    description: Create a production NG2 app & test in lighthouse
    tasks:
      - ng:build
      - [ng:serve, ng:lighthouse]